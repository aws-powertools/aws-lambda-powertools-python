# CDK Powertools layer

This is a CDK project to build and deploy AWS Lambda Powertools layer to multiple commercial regions.

## Build the layer

To build the layer construct you need to provide the powertools version.
You can pass it as a context variable when running `synth` or `deploy`,

```shell
cdk synth --context version=1.25.1
```

## Canary stack

We use a canary stack to verify that the deployment is successful and we can use the layer by adding it to a newly created Lambda function.
The canary is deployed after the layer construct. Because the layer ARN is created during the deploy we need to pass this information async via SSM parameter.
To achieve that, we establish a naming convention for the SSM key. The layer construct knows where to write the layer ARN after the deployment and the Canary stacks know where to read this information.

## Version tracking

AWS Lambda versions the layers by incrementing a number at the end of the arn.
This means it's hard to tell which powertools version is inside the layer.
For better tracking of the ARNs and the corresponding version we need to keep track which powertools version was deployed to which layer.
To achieve that we created two components. First, we created a version tracking app which receives evnets via Event Bridge. Second, after a successful canary deployment we send the layer ARN, powertools version, and the region to this Event Bridge.
